{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/incidentes.css">
{% endblock %}

{% block content %}

<h1 class="incident-title">
    üö® Portal de Incidentes
    <span class="incident-subtitle">Monitoramento e gest√£o operacional</span>
</h1>

<!-- SEARCH BAR CORRIGIDA E 100% ALINHADA -->
<div class="incident-search">
    <div class="incident-search-box">
        <span class="search-icon">üîç</span>
        <input id="pageSearch" type="text" placeholder="Pesquisar nesta p√°gina..." oninput="searchLocal()">
    </div>
</div>



<!-- CARDS RESUMO -->
<div class="incident-cards">

    <div class="incident-card open">
        <h3>Abertos</h3>
        <p class="number">4</p>
        <span class="card-icon">!</span>
    </div>

    <div class="incident-card progress">
        <h3>Em andamento</h3>
        <p class="number">2</p>
        <span class="card-icon">‚Üª</span>
    </div>

    <div class="incident-card resolved">
        <h3>Resolvidos</h3>
        <p class="number">12</p>
        <span class="card-icon">‚úì</span>
    </div>

    <div class="incident-card month">
        <h3>Total no m√™s</h3>
        <p class="number">18</p>
        <span class="card-icon">üìÖ</span>
    </div>

</div>

<!-- A√á√ïES -->
<div class="incident-actions">
    <button class="new-incident-btn" onclick="alert('Novo incidente em breve...')">
        ‚ûï Registrar Incidente
    </button>
</div>

<!-- LISTA -->
<h2 class="incident-section-title">Incidentes Recentes</h2>

<table class="incident-table">
    <thead>
        <tr>
            <th>Sistema</th>
            <th>Falha</th>
            <th>Equipe</th>
            <th>Status</th>
            <th>Atualiza√ß√£o</th>
            <th>A√ß√£o</th>
        </tr>
    </thead>

    <tbody>

        <tr>
            <td><strong>Sentinela</strong></td>
            <td>Erro de autentica√ß√£o</td>
            <td>Infraestrutura / Sistemas</td>
            <td><span class="tag open">Inoperante</span></td>
            <td>12/02/2025 09:40</td>
            <td>
                <button class="action-btn"
    onclick="abrirResumo(
        'Sentinela',
        'Erro de autentica√ß√£o',
        'Infraestrutura / Sistemas',
        'O sistema apresenta falha no login via CNJ corporativo. An√°lise indica instabilidade no servi√ßo de autentica√ß√£o externo.',
        'Inoperante'
    )">
    üîç
</button>

            </td>
        </tr>

        <tr>
            <td><strong>GLPI</strong></td>
            <td>Interface n√£o carrega</td>
            <td>Service Desk</td>
            <td><span class="tag progress">Em tratamento</span></td>
            <td>12/02/2025 08:15</td>
            <td>
                <button class="action-btn"
    onclick="abrirResumo(
        'GLPI',
        'Interface n√£o carrega',
        'Service Desk',
        'Usu√°rios relatam tela em branco ap√≥s login. Equipe est√° validando servi√ßo web.',
        'Em tratamento'
    )">
    üîç
</button>

            </td>
        </tr>

        <tr>
            <td><strong>VPN Corporativa</strong></td>
            <td>Conex√£o inst√°vel</td>
            <td>Redes</td>
            <td><span class="tag resolved">Resolvido</span></td>
            <td>11/02/2025 17:30</td>
            <td>
                <button class="action-btn"
    onclick="abrirResumo(
        'VPN Corporativa',
        'Conex√£o inst√°vel',
        'Redes',
        'Falha causada por manuten√ß√£o no firewall. Servi√ßo normalizado.',
        'Resolvido'
    )">
    üîç
</button>

            </td>
        </tr>

    </tbody>
</table>

<!-- MODAL -->
<div id="incidentModal" class="incident-modal">
    <div class="incident-modal-content">
        <h3 id="modalSistema"></h3>

        <span id="modalStatus" class="modal-status"></span>

        <p><strong>Falha:</strong> <span id="modalFalha"></span></p>
        <p><strong>Equipe respons√°vel:</strong> <span id="modalEquipe"></span></p>

        <div class="modal-resumo">
            <strong>Resumo do problema</strong>
            <p id="modalResumo"></p>
        </div>

        <button class="modal-close" onclick="fecharResumo()">Fechar</button>
    </div>
</div>

<script>
function abrirResumo(sistema, falha, equipe, resumo, status) {
    document.getElementById("modalSistema").innerText = sistema;
    document.getElementById("modalFalha").innerText = falha;
    document.getElementById("modalEquipe").innerText = equipe;
    document.getElementById("modalResumo").innerText = resumo;

    // Status
    const statusEl = document.getElementById("modalStatus");
    statusEl.innerText = status;
    statusEl.className = "modal-status " + status.toLowerCase();

    document.getElementById("incidentModal").style.display = "flex";
}

function fecharResumo() {
    document.getElementById("incidentModal").style.display = "none";
}

/* üîë FECHAR COM ESC */
document.addEventListener("keydown", function (event) {
    if (event.key === "Escape") {
        fecharResumo();
    }
});
</script>

</script>
<script>
function searchLocal() {
    let term = document.getElementById("pageSearch").value.toLowerCase();
    let rows = document.querySelectorAll(".incident-table tbody tr");

    rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(term) ? "" : "none";
    });
}
</script>

{% endblock %}
